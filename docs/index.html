<!DOCTYPE html>
<html ng-app="docModule">
    <head>
        <title>iUcto API dokumentace</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-theme.min.css">
        <script src="assets/jquery.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>        
        <script src="assets/angular.js"></script>
        <script src="assets/ui-bootstrap-tpls-0.11.0.min.js"></script>
        <script src="assets/definition.js"></script>
        <script>
            var docModule = angular.module('docModule', ['ui.bootstrap']);
            docModule.value('docData', docDefinition)
                    .controller('docController', function($scope, $http, docData) {
                        $scope.docData = docData;
                        angular.forEach($scope.docData.services, function(service, key) {
                            service.isCollapsed = true;
                            $http.get("getExample.php?name=" + service.name).success(function(data) {
                                service.example = data;
                            });
                        });
                    })
                    .directive('params', function($compile) {
                        return {
                            restrict: 'E',
                            terminal: true,
                            scope: {val: '=', parentData: '='},
                            link: function(scope, element, attrs) {
                                scope.isComplexDataType = function(value) {
                                    var result = typeof value.dataType === 'object' && angular.isArray(value.dataType.fields);
                                    return result;
                                }
                                var simpleTypeInfo = '';
                                if (!scope.isComplexDataType(scope.val)) {
                                    simpleTypeInfo = ' <span class="type-name">{{val.dataType}}</span>';
                                }
                                var description = '';
                                if (scope.val.description) {
                                    description += ' - <span class="description">{{val.description}}</span>';
                                }
                                var template = '<span>{{val.name}}' + simpleTypeInfo + description + '</span>';
                                if (scope.isComplexDataType(scope.val)) {
                                    template += '<ul class="indent"><li ng-repeat="item in val.dataType.fields"><params val="item" parent-data="val.dataType.fields"></params></li></ul>';
                                }
                                var newElement = angular.element(template);
                                $compile(newElement)(scope);
                                element.replaceWith(newElement);
                            }
                        }
                    });
        </script>
    </head>
    <body ng-controller="docController">
        <div class="bs-docs-header" id="content">
            <div class="container">
                <h1>{{docData.apiName}} <span class="version">{{docData.apiVersion}}</span></h1>
                <div ng-repeat="service in docData.services">
                    <a href="#" ng-click="service.isCollapsed = !service.isCollapsed"><h3>{{service.name}}</h3></a>
                    <div collapse="service.isCollapsed">
                        <p>{{service.shortDescription}}</p>
                        <p ng-show="!service.parameters">Bez parametrů</p>
                        <div ng-if="service.parameters">
                            <h4>Parametry volání</h4>
                            <div ng-repeat="param in service.parameters">
                                <params val="param"></params>
                            </div>
                        </div>
                        <div ng-if="service.returns">
                            <h4>Návratový typ</h4>
                            <p>Je asociativní pole s těmito klíči:</p>
                            <params val="service.returns"></params>

                        </div>
                        <h4>Příklad</h4>
                        <pre style="white-space: pre;">{{service.example}}</pre>                    
                        <div ng-if="service.throws">
                            <h2>Výjimky</h2>
                            <ul>
                                <li ng-repeat="error in service.throws">
                                    {{error.name}} - {{error.description}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
